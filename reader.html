<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>;_;</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="main.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="assets/favicon.ico">
	<script type="text/javascript" src="data.js"></script>
	<script>

	function fetchImgurAlbum(albumID) {
	    var albumAPI = "https://api.imgur.com/3/album/" + albumID + "/images";

		$.ajax({
			url: albumAPI,
			headers:{
				'Authorization':'Client-ID ' + CLIENT_ID
			},
			type: 'GET',
			dataType: 'json',
			success: function(data) {
				var images = data.data;
				var numImages = images.length;

				var imagesToAppend = numImages - 5;
				/*for (var i = imagesToAppend; i >= 0; i--) {
					appendImage('https://via.placeholder.com/500');
				}*/

				var links = data.data.map(function(item) {
				    return item.link;
				});

				loadImagesInSequence(links, () => {
					$('img').on('click', function(e) {
						e.preventDefault();
						window.scrollTo(0, this.y + this.height + 18);
					});
				});
			},
			error: function(e) { console.log("ERROR", e); }
		});
	};

	var reader;

	function loadImagesInSequence(images, complete) {
		if (!images.length) {
			complete();
			return;
		}

		url = images.shift();

		var img = new Image();
		//img.className  = "readerimg";
		img.onload = function() { loadImagesInSequence(images, complete) };
		img.src = url;
		reader.append(img);
	}

	function appendImage(url) {
		reader.append('<img class="readerimg" src="'+url+'" />');
	}

	var loaded = false;

	window.onload = (e) => {
		reader = $("#reader");

		/*for (var i=0; i < 10; i++) {
			appendImage('https://via.placeholder.com/500');
		}
		$("img.readerimg").bind('load', function() {
			if (!loaded) {
				reader.show();
			} else {
				return true;
			}
		});*/
		
		/*loadImagesInSequence(['https://via.placeholder.com/500', 'https://via.placeholder.com/500', 'https://via.placeholder.com/500', 'https://via.placeholder.com/500', 'https://via.placeholder.com/500','https://via.placeholder.com/500','https://via.placeholder.com/500','https://via.placeholder.com/500','https://via.placeholder.com/500','https://via.placeholder.com/500','https://via.placeholder.com/500'], () => {
			$('img').on('click', function(e) {
				e.preventDefault();
				window.scrollTo(0, this.y + this.height + 18);
			});
		});*/


		//imgElems = document.getElementsByClassName('readerimg');

		var $chapter = $("a#chapter");

		var link = parseChapterLink(window.location.href);
		$chapter[0].innerText += " " + CHAPTER_LINKS[link];

		/*document.getElementById("image-width").oninput = function() {
			$("#reader").css("width", this.value + "");
		}*/

		fetchImgurAlbum(link);
	}

	function parseChapterLink(url) {
		var qmarkIndex = url.indexOf("?");
		if (qmarkIndex == -1) {
			return "";
		}

		var link = url.slice(qmarkIndex + 1, url.length);
		return link;
	}

	</script>
	<style>
        .main {
        	height:	auto;
            min-height: 100vh;
			cursor: url("assets/cursor2.png"), auto;
        }

		#reader {
			height: auto;
			width: 800px;
			margin: 0 auto;
			padding-top: 80px;
		}

		#wrapper {
			margin-top: 100px;
			background-color: #161a1d;
		}

		#reader img {
			margin: 7px 0;
			width: 100%;
			-webkit-box-shadow: 0px 0px 8px 1px rgba(0,0,0,0.45); 
			box-shadow: 0px 0px 8px 1px rgba(0,0,0,0.45);
		}

		#reader img:hover, input:hover {
			cursor: url("assets/cursor1.png"), auto!important;
		}

		#nav {
			width: 100%;
			z-index: 100;
			position: fixed;
			border: none;
			top: 0;
			background-color: #333533;
		}

		#nav li a {
			position: relative;
		}

		#nav li a:hover {
			background-color: #333533!important;
		}

		#nav li a.back::after {
			position: absolute;
			content: 'Â»';
			color: #ccc;
			top: 0;
			line-height: 39px;
			margin: 0 20px;
			z-index: 99;
		}

		#test {
			height: 2000px;
			width: 200px;
			background: red;
		}

		#side {
			position: fixed;
			top: 50%;
			left: 150px;
  			transform: translate(-50%, -50%);
			vertical-align: middle;
			width: 200px;
			height: 400px;
			background: #2F2828;
			color: #f5f3f4;
			padding: 2em;
		}

		.slider {
		  -webkit-appearance: none;
		  width: 100%;
		  height: 20px;
		  border-radius: 0;  
		  background: #161a1d;
		  outline: none;
		  opacity: 0.7;
		  -webkit-transition: .2s;
		  transition: opacity .2s;
		}

		.slider::-webkit-slider-thumb {
		  -webkit-appearance: none;
		  appearance: none;
		  width: 10px;
		  height: 20px;
		  border-radius: 0px; 
		  background: #9B9797;
		}

		.slider::-moz-range-thumb {
		  width: 10px;
		  height: 20px;
		  border-radius: 0px;
		  background: #9B9797;
		}
	</style>
</head>
<body>
	<div class="main">
		<nav id="nav">
		     <ul>
				<li>READING: </li>
				<li><a href="gou" class="back">Higurashi Gou</a><a id="chapter" href="gou">Chapter</a></li>
		     </ul>
		</nav>
		<!--<div id="side">
			<h2>Chapter</h2>
			Adjust image width<br/>
			<input type="range" min="600" max="1000" value="800" id="image-width" class="slider">
		</div>-->
		<div id="reader"></div>
	</div>
</body>