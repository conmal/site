<!DOCTYPE html>
<html>
<head>
	<meta charset="UTF-8">
	<title>;_;</title>
	<script src="https://code.jquery.com/jquery-3.6.0.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script>
	<link rel="stylesheet" type="text/css" href="main.css">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="assets/favicon.ico">
	<script type="text/javascript" src="data.js"></script>
	<script>

	function fetchImgurAlbum(albumID) {
	    var albumAPI = "https://api.imgur.com/3/album/" + albumID + "/images";

		$.ajax({
			url: albumAPI,
			headers:{
				'Authorization':'Client-ID ' + CLIENT_ID
			},
			type: 'GET',
			dataType: 'json',
			success: function(data) {
				var images = data.data;
				var numImages = images.length;

				var imagesToAppend = numImages - 5;
				/*for (var i = imagesToAppend; i >= 0; i--) {
					appendImage('https://via.placeholder.com/500');
				}*/

				var links = data.data.map(function(item) {
				    return item.link;
				});

				loadImagesInSequence(links);
			},
			error: function(e) { console.log("ERROR", e); }
		});
	};


	var reader;
	var loaded = 0;
	var imgElems;
	function loadImagesInSequence(images) {
		if (!images.length) {
			return;
		}

		url = images.shift();

		var img = new Image();
		img.className  = "readerimg";
		img.onload = function() { loadImagesInSequence(images) };
		img.src = url;
		reader.append(img);
		console.log(img);
		/*} else {
			imgElems[loaded].src = url;
			loaded++;
		}*/
	}

	function appendImage(url) {
		reader.append('<img class="readerimg" src="'+url+'" />');
	}

	var loaded = false;

	window.onload = (e) => {
		reader = $("#reader");

		/*for (var i=0; i < 10; i++) {
			appendImage('https://via.placeholder.com/500');
		}
		$("img.readerimg").bind('load', function() {
			if (!loaded) {
				reader.show();
			} else {
				return true;
			}
		});*/

		imgElems = document.getElementsByClassName('readerimg');

		var $chapter = $("a#chapter");

		var link = parseChapterLink(window.location.href);
		$chapter[0].innerText += " " + CHAPTER_LINKS[link];

		fetchImgurAlbum(link);
	}

	function parseChapterLink(url) {
		var qmarkIndex = url.indexOf("?");
		if (qmarkIndex == -1) {
			return "";
		}

		var link = url.slice(qmarkIndex + 1, url.length);
		return link;
	}
	</script>
	<style>
		html {
			height: 100%;
			background-color: #242423;
		}
		body {
			min-height: 100%;
			background-color: #242423;
		}

        .main {
        	height:	auto;
            min-height: 100%;
            background-color: #242423;
			background-size: 30%;
			cursor: url("assets/cursor2.png"), auto;
        }

		#reader {
			height: auto;
			width: 800px;
			margin: 0 auto;
			padding-top: 80px;
		}

		#wrapper {
			margin-top: 100px;
			background-color: #161a1d;
		}

		#reader img {
			margin: 7px 0;
			width: 100%;
			-webkit-box-shadow: 0px 0px 8px 1px rgba(0,0,0,0.45); 
			box-shadow: 0px 0px 8px 1px rgba(0,0,0,0.45);
		}

		#nav {
			width: 100%;
			z-index: 100;
			position: fixed;
			border: none;
			top: 0;
			background-color: #333533;
		}

		#nav li a {
			position: relative;
		}

		#nav li a:hover {
			background-color: #333533!important;
		}

		#nav li a.back::after {
			position: absolute;
			content: 'Â»';
			color: #ccc;
			top: 0;
			line-height: 39px;
			margin: 0 20px;
			z-index: 99;
		}

		#test {
			height: 2000px;
			width: 200px;
			background: red;
		}

		#container {
			width: 80%;
			height: auto;
			margin: 0 auto;
			background: #1e1e1e;
		}
	</style>
</head>
<body>
	<div class="main">
		<nav id="nav">
		     <ul>
				<li>READING: </li>
				<li><a href="gou" class="back">Higurashi Gou</a><a id="chapter" href="gou">Chapter</a></li>
		     </ul>
		</nav>
		<div id="reader"></div>
	</div>
</body>